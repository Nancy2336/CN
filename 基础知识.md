# OSI七层模型
 OSI：开放式系统互联通信参考模型（英语：Open System Interconnection Reference Model），简称为OSI模型，一种概念模型，由国际标准化组织提出，一个试图使各种计算机在世界范围内互连为网络的标准框架。它是一个定义得非常好的协议规范，定义于ISO/IEC 7498-1。网络协议（从下到上）分为物理层、数据链路层、网络层、传输层、会话层、表示层和应用层七层，每层都可以有几个子层。其中高层（即7、6、5、4层）定义了应用程序的功能，下面3层（即3、2、1层）主要面向通过网络的端到端，点到点的数据流。

## 层次介绍
- 物理层     Physical Layer
物理层是OSI参考模型的最低层。物理层的作用是**实现相邻计算机节点之间比特流的透明传送**，尽可能屏蔽掉具体传输介质和物理设备的差异。“透明传输比特流”表示经实际电路传送后比特流没有发生变化，对传送的比特流来说，这个电路好像是看不见的。
例如：网线，网卡。

- 数据链路层      Data Link Layer
数据链路层是OSI模型的第二层，负责建立和管理节点间的链路。该层的主要功能是：通过各种控制协议，将有差异的物理信道变为无差错的、能可靠传输数据帧的数据链路。在计算机网络中由于各种干扰存在，物理链路是不可靠的。因此，这一层的主要功能是在物理层提供的比特流的基础上，通过差错控制、流量控制方法，是有差错的物理线路变为无差错的数据链路，即提供可靠的通过物理介质传输数据的方法。数据链路层的具体工作是接收来自物理层的位流形式的数据，并封装成帧，传送到上一层；同样也将来自上层的数据帧，拆装成位流形式的数据转发到物理层；并且，还负责处理接收端发回的确认帧信息，以便提供可靠的数据传输。
例如：网桥和交换机。

- 网络层   Network Layer
网络层是OSI模型的第三层，它是最复杂的一层。它在上下两层的基础上向资源子网提供服务。其主要任务是：通过路由选择算法，为报文或分组通过通信子网选择最适当的路径。具体地说，数据链路层的数据在这一层被转换为数据包，然后通过路径选择、分段组合、顺序、进/出路由等控制，将信息从一个网络设备传送到另一个网络设备。一般地，**数据链路层是解决同一个网络内节点之间的通信，而网络层主要解决不同子网间的通信**。例如在广域网之间通信时，必然会遇到路由（即两节点之间可能有多条路径）选择问题。
例如：IP/IPv6协议

- 传输层  Transport Layer 
传输层是OSI模型的第四层，因此该层是通信子网和资源子网的接口和桥梁，起承上启下作用。该层的主要作用是：向用户提供可靠的端到端的差错和流量控制，保证报文的正确传输。传输层的作用是向高层屏蔽下层数据通信的细节，即向用户透明的传送报文。该层常见的协议：TCP/IP中的TCP协议和UDP协议。传输层提供会话层和网络层之间的传输服务，这种服务从会话层获得数据，并在必要时对数据进行分割。然后，传输层将数据传输到网络层，并确保数据能够正确无误的传送到网络层。因此，传输层负责提供两点之间数据的可靠传送，当两节点的联系确定后，传输层则负责监督工作。综上，传输层的主要功能如下：**监控服务质量**。

- 会话层   Session Layer
会话层是OSI模型的第五层，是用户应用程序和网络之间的接口，主要任务是：向两个实体的表示层提供建立和使用连接的方法。 将 不同实体之间的表示层的连接 称为会话。因此会话层的任务就是**组织和协调两个会话进程之间的通信，并对数据就交换进行管理**。用户可以按照半双工、单工和全双工的方式建立会话。当建立会话时，用户必须提供他们想要连接的远程地址，而这些地址与MAC(介质访问控制子层)地址或网络层的逻辑地址不同，他们是为用户专门设计的，更便于用户记忆。

- 表示层  Presentation Layer
表示层是OSI模型的第六层，它对来自应用层的命令和数据进行解释，对各种语法赋予相应的含义，并按照一定的格式传送给会话层。其主要功能是“**处理用户信息的表示问题，如编码、数据格式转换和加密解密**”等。

- 应用层  Application Player
应用层是OSI参考模型的最高层，它是计算机用户以及各种应用程序和网络之间的接口，其功能是**直接向用户提供服务**，完成用户希望在网络上完成的各种工作。它在其他六层工作的基础上，负责完成网络中应用程序与网络操作系统之间的联系，建立与结束使用者之间的联系，并完成网络用户提出的各种网络服务及应用所需的监督、管理和服务等各种协议。此外，该层**还负责协调各个应用程序间的工作**。
例如：http、ftp、dns等

## 各层协议
- **物理层**（比特流）：主要包括的协议为：IEEE802.3、CLOCK、RJ45
通过媒介传输比特，传输单位为**bit**。
设备之间比特流传输，简单的传送01比特。
底层数据传输，如网线；网卡标准。

- **数据链路层**：主要包括的协议为：MAC、VLAN、PPP
将比特组装成帧和点到点的传递，传输单位为**帧**。
将物理层的比特流数据封装为帧，提供简单的差错检测。
定义数据的基本格式，如何传输，如何标识：如网卡MAC地址。

- **网络层**：主要包括的协议为：IP、ARP、ICMP
负责数据包从源到宿的传递和网际互连，传输单位为**包**
提供逻辑地址（IP）、选择路径，数据从 源端 到 目的端 的传输

- **传输层**：主要包括的协议为：TCP、UDP
提供端到端的可靠报文传递和错误恢复，传输单位为**报文**
实现**网络不同主机上用户进程之间的数据通信**，可靠与不可靠的传输，传输层的错误检测，流量控制等

- **会话层**：主要包括的协议为：RPC、NFS
建立、管理和终止会话，传输单位为**SPDU**
提供包括 访问验证 和 会话管理在内的建立和维护应用之间通信 的机制，如服务器验证用户登录便是由会话层完成的。

- **表示层**：主要包括的协议为：JPEG、ASII
对数据进行翻译、加密和压缩，传输单位为**PPDU**
主要解决用户信息的语法表示问题，如加密解密

- **应用层**：主要包括的协议为：HTTP、FTP、DNS
允许访问OSI环境的手段，传输单位为**APDU**
确定**进程之间通信的性质**以满足用户需要以及**提供网络与用户应用**

物理层：IEEE  RJ45  CLOCK
数据链路层：MAC  VLAN  PPP
网络层：IP  ARP  ICMP
传输层：TCP  UDP
会话层：RPC  NFS
表示层：JPEG  ASII
应用层：HTTP  FTP  DNS

<p>
<p>
<p>
<p>
<p>

# TCP/IP四层模型
	网络四层模型由七层模型简化合并而来。
	应用层、传输层、网络层和网络接口层（包括数据链路层和物理层）
 
 TCP/IP 4层模型包括：
 - 链路层：接收网络层的IP数据包，封装成帧发送到网络；从网络接收物理帧，抽出IP数据包，交给网络层。
 协议：MAC、VLAN
 - 网络层：将传输层的信息流打包成IP数据包，交给链路层进行不同主机间通信。
 协议：IP、ARP、ICMP
 - 传输层：负责应用程序间的通信，将来自应用程序的信息流格式化封装。
 协议：TCP、UDP
 - 应用层：载有应用程序，将数据发送给传输层。
 协议：HTTP、FTP、DNS、SMTP(Simple Mail Transfer Protocol，简单邮件传输协议是在Internet传输email的事实标准。SMTP主要是用于传输邮件，SMTP是一个相对简单的基于文本的协议。SMTP使用TCP端口25。)

<p>
<p>
<p>
<p>
<p>

# 交换机与路由器
两种联网的中继设备。

## 交换机
交换机就是记录一下哪个端口上有哪个MAC地址，形成一个MAC地址和端口的绑定表，按照这个表转发数据。交换机全部转发的前提是在同一个VLAN内，并且在同一个网段（更专业的说法是在同一个网络）内。

交换机的原理比较简单，一般都是采用硬件电路实现数据帧的转发。

交换机是根据MAC地址转发**数据帧**，数据帧是在IP数据报/分组的基础上封装了帧头（源MAC和目的MAC）和帧尾（CRC校验码）。

交换机主要用于**组建局域网**。

交换机分割冲突域，但是不分割广播域。由交换机连接的网段属于同一个广播域，广播数据包会在交换机连接的所有网段上传播。**交换机会转发广播数据**给局域网中的所有主机。
冲突域：物理上连在一起可能发生冲突的网络分段。也就是说一条总线上的机器，一个hub（共享总线）连的机器都是冲突域的。

## 路由器
所谓“路由”，是指把数据从一个地方传到另一个地方的行为和动作，而路由器正是执行这种行为动作的机器。

路由器只接受源站或其他路由器的信息，属于网络层的一种互联设备，它虽与各个子网使用的硬件设备无关，但要求其运行于网络层协议相一致的软件。

它的英文名Router，是一种连接多个网络或网段的网络设备，它能将不同网络或网段之间的数据信息进行“翻译”，以使它们能够相互“读懂”对方的数据，从而构成一个更大的网络。简单说就是通过路由器使多个设备彼此相连形成局域网。

**路由器运行在网络层上，所以路由器是根据IP地址来转发IP数据报/分组**

路由器是负责让主机**连接外网**。局域网的所有主机使用的都是私网的IP，所以必须通过路由器转化为公网的IP之后才能访问外网。
路由器分割广播域，**不会转发广播数据**。
路由器一般有防火墙功能，能够对一些网络数据包选择性过滤。

- 什么是路由器
相同网络可以直接通信，**不同网络间通信**需要路由。提供路由功能最专业的的设备是路由器，是实现网络互联的最核心设备。
- 路由器的作用
路由：负责在不同的网络之间转发数据的设备
选路：决定达到目标的路径
- 路由表（相当于公交站牌，告诉你去什么地方做什么车）
每个路由器都有一个路由表，路由器收到数据后检查数据包的目标IP，然后再看自己的路由表，根据路由表转发数据。

## 两者区别
（1）外形不同
&emsp;交换机通常端口较多比较笨重，而路由器的端口少体积也小，但一般看见的路由器并不是真正的路由器，只是集成了路由器功能，除此之外它还具有交换机的功能（LAN口是作为交换机的端口来使用，WAN口是用于连接外网的端口），而两个天线则是无线AP接入点（即是通常所说的无线局域网wifi）
（2）工作层次不同
&emsp;最初的交换机工作在OSI开放式系统互联模型的数据链路层（第二层），而路由器则工作在OSI模型的网络层（第三层）。由于这一点所以交换机的原理比较简单，一般是采用硬件电路实现数据帧的转发，而路由器工作在网络层，肩负着网络互联的重任，要实现更加复杂的协议，具有更加智能的转发决策功能，一般都会在路由器中跑操作系统，实现复杂的路由算法，更偏向于软件实现其功能。
（3）数据的转发对象不同
&emsp;交换机是根据MAC地址转发**数据帧**，而路由器则是根据IP地址来转发IP数据报/分组。数据帧是在IP数据报/分组的基础上封装了帧头（源MAC和目的MAC等）和帧尾（CRC校验码）。
（4）“分工”不同
&emsp;交换机主要用于**组建局域网**，而路由器则是负责让主机连接外网。多台主机可以通过网线连接到交换机，这时就组建好了局域网，就可以将数据发送给局域网中的其他主机，如飞秋等局域网软件就是通过交换机把数据转发给其他主机的，当然也有像极域电子教室这样的广播软件是利用广播技术让所有主机都收到数据的。然而，通过交换机组成的局域网是不可以访问外网的，局域网所有主机使用的都是私网IP，所以必须通过路由器转化为公网的IP之后才能访问外网。
（5）冲突域与广播域
&emsp;交换机分割冲突域，但是不分割广播域，而路由器分割广播域。由交换机连接的网段仍属于同一个广播域，广播数据会在交换机连接的所有网段上传播，在这种情况下会导致广播风暴和安全漏洞问题。而连接在路由器上的网段会被分配不同的广播域，路由器不会转发广播数据。需要说明的是单播的数据报在局域网中会被交换机唯一地送往目标主机，其他主机不会接收到数据，这是区别于原始的集线器，数据的到达时间由交换机的转发速率决定，交换机会转发广播数据给局域网的所有主机。
<br>【补充】路由器一般有防火墙功能，能够对一些网络数据包选择性过滤。现在的一些路由器都具备交换机的功能，一些交换机具备路由器功能，被称为3层交换机。相比较而言，路由器的功能较交换机要强大，但是速度也比较慢，价格昂贵，三层交换机既有交换机的线性转发报文能力，又有路由器的良好路由功能，因此得到广泛使用。

[浅谈交换机与路由器区别](https://blog.csdn.net/liebao_han/article/details/52859814)


## 小结
可以理解为，交换机是组建局域网、暴露局域网；路由器是暴露局域网，连接别的局域网。
交换机在数据链路层，路由器在网络层，路由器它会根据信道的情况自动选择和设定路由，以最佳路径，按前后顺序发送信号。
IP地址决定最终数据包要到达某一台主机，而**MAC地址则是决定下一跳**将要交互给哪一台设备（一般是路由器或主机）。


<p>
<p>
<p>
<p>
<p>

# 问题整理
>为什么需要两个地址？MAC地址和IP地址
>个人小结：因特网在制定之初并没有定义从物理层到传输层的协议（没有定义底层），所以它需要依赖其他网络，像是以太网这样的2层网协议，而MAC地址又是2层概念，所以MAC地址就这样进入了因特网的体系结构。
像是以太网只定义1~2层（物理层、数据链路层），IP和TCP分别定义了3、4层（网络层、传输层），再往上既有因特网的协议（比如FTP），也有其它公司的一些高层协议（比如SQL、JPEG、HTTP）这样，不同的网络、不同的协议之间相互配合就可以制定完备了。
>参考资料：[有了 IP 地址，为什么还要用 MAC 地址？](https://www.zhihu.com/question/21546408/answer/53576595)  
>[有了 IP 地址，为什么还要用 MAC 地址？](https://www.zhihu.com/question/21546408)
><br> ==【补充1】== 实际上IP地址决定最终数据报要到达某一台主机，而MAC地址则是决定下一跳将要交互给哪一台设备（一般是交换机或主机）。而且IP地址是软件实现的，可以描述主机所在的网络，MAC地址是硬件实现，每一个网卡在出厂时会将全世界唯一的MAC地址固化在网卡的ROM中，所以MAC地址是不可以被修改的，IP地址是可以被网络管理人员配置修改的。
>【补充2】因特网最初是国防通信网络（APRA-阿帕网），后演变成连接各大学、政府部门和科研机构的教学科研网，最后演变为烧钱的商业化网络，这就是“因特网的体系结构”。
因特网协议：TCP/IP协议族，（TCP/IP是专为因特网开发的一系列协议当中的2个协议，因这2个协议最重要也最出名，就用这2个协议代指因特网协议。）从一开始，因特网就没有想过成为世界性大网，所以因特网的协议从制定之初就是”不完备“的。 也就是说，因特网必须要基于其它网络之上，依靠其它的网络才能完成自身的功能。
比如，已经存在一种局域网技术，叫做”以太网“，因特网就运行于以太网之上，英文写作：
TCP/IP over Ethernet
还有一种城域网技术叫做“令牌环网 ”，因特网就运行在令牌环网之上 ，英文写作：
TCP/IP over Token-ring
还有一种广域网技术叫做"ATM"，因特网就运行于ATM之上，英文写作：
TCP/IP over ATM
>【补充3】因特网必须要基于像以太网这样的2层网之上才能工作，所以必须要“翻译”，也就是把以太网的MAC地址翻译成因特网的IP地址，这就是ARP的作用。

> 数据包与数据报区别
>  **具体区别就是所工作的层不同。** 数据发送时，由上层向下层封装。
&emsp;四层，传输层传输的是数据报文，主要是协议格式；
&emsp;三层，网络层传输的是数据包，包含数据报文，并且增加传输使用的ip地址等三层信息；
&emsp;二层，数据链路层传输的是数据帧，包含数据包，并且增加相应mac地址与二层信息。
>数据报也是分组交换的一种形式，就是把所传送的数据分段打成“包”，再传送出去。看上去就好象运货装“集装箱”似的。但是，与传统的“连接型”分组交换不同，它属于“无连接型”，是把打成的每个“包”（分组）都作为一个“独立的报文”传送出去，所以叫做“数据报”。

>无线局域网中使用无线路由器出现的隐蔽站和暴露站问题介绍
> &emsp;①隐蔽问题：当两个机器检测不到一个无线网信号的时候就以为它是空闲的，然后同时发送请求，结果发生碰撞。这就叫隐蔽站。
> &emsp;②暴露问题：当一个机器A想向外发送信号时候，却发现信道忙，而等待。但是忙着的信道是B，C机器，其中B是在A的信号范围内的，而C不在A的信号范围内。但是 BC在通信，所以虽然C不在A的信号范围内它也知道了C在忙。这就是暴露站。



# 计算机的通信方式
了解计算机的通信方式，可以更好地帮助我们理解网络是如何交互的。（引申到单工、半双工、全双工建立会话方式介绍）
计算机的两种基本通信方式是串行通信和并行通信。

## 串行通信
串行通信是一种通信双方按位进行，遵守时序的一种通信方式。串行通信指在计算机总线或其他数据通道上，每次传输一个位元数据，并连续进行以上单次过程的通信方式。串行通信被用于长距离以及大多数计算机网络。主要起到 主机与外设 以及 主机之间 的数据传输作用，串行通信具有传输线少、成本低的特点，适用于近距离的人-机交换、实时监控等系统。

## 并行通信
并行通信是在串行端口上通过一次同时传输若干 位元数据的方式进行通信。多比特数据同时通过并行线进行传送，这样的数据传送速度大大提高，但并行传送的线路长度受到限制，因为长度增加干扰就会增加，数据也容易出错。

## 串行和并行区别：
1、发送数据量不同：串行通信用一根线在不同时刻发送多位数据，并行通信在同一时刻发送多位数据。
2、传输距离不同：串行通信传输距离远，占用资源少，并行通信则传输距离较短。
3、速度不同：串行通信发送速度慢，并行通信发送速度快、占用资源多。

## 通信模式
我们在串行通信中，数据通常是在两个站（如终端和微机）之间进行传送，按照数据流的方向可分成三种基本的传送方式：单工通信和双工通信中的全双工、半双工。

| 通信的种类 | 说明 |
| ---------------|-------|
|单工模式（Simplex）| 类似于电视、广播中电磁波信号的传输，一般为固定发送方（电视台、广播站）与固定接收方（接收天线）之间的通信方式，也称为单向通信|
|双工通信（Duplex）| 通信的过程中没有明确的发送方和接收方，双方能够互换角色的通信方式|

双工通信
|通信的种类|说明|
|---------------|------|
|半双工通信（Half-duplex）|类似于无线对讲机的通信方式，通信的一方在说话时（信号发送时），另一方不能说话|
|全双工通信（Full-duplex）|类似于电话的通信方式，通信的一方正在说话，另一方也可以说话|
![通信方式图示](https://img-blog.csdnimg.cn/57e304d8cf1b4e0ca3e1a519dcf84b0f.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5LqM5qyh5pa556iL,size_18,color_FFFFFF,t_70,g_se,x_16)
### 单工通信
单工通信信道是单向信道，发送端和接收端的身份是固定的。发送端只能发送信息，不能接收信息；接收端只能接收信息，不能发送信息，数据信号仅能从一端传送到另一端，即信息流是单向的。例如广播电视就是最好的单工方式。根据接收频率的异同，单工通信可分为同频通信和异频通信。

同频是指通信双方使用相同的工作频率。生活中使用的电台之间可直接通话，不需基站转接。通信双方的操作采用“按-讲”（PPT - Push to Talk）方式。在该方式中，电台的接发信机不需要使用天线共用器，而是使用同一副天线。平时双方的接收机均处于收听状态，不按键时发射机不工作，功耗小。缺点是当有两个以上的移动台同事发射时就会出现同频干扰，所以只适用于组建简单和甚小容量的通信网。

异频在无中心转信台转发的情况下，电台要配对使用，否则通信双方无法通话，故异频单工方式主要用于有中心转信台转发的情况，由于收发频率有一定的保护间隔，提高了抗干扰能力，中心转信台的加入使通信区域得到有效扩大，因此这种方式常用于组建有几个频道同时工作的专用网。

## 半双工通信
半双工通信也叫双向交替通信，通信的双方都可以发送信息，但双方不能同时发送或接收。它实际上可以理解为一种可以切换方向的单工通信。和对讲机类似，一方讲话的时候另一方不能讲话，通过切换键可以改变通话方式。
在以太网中进行数据通信时，就使用只支持半双工的集线器进行收发数据包的操作，如果多台计算机同时发送信息，信号就会在集线器内部混杂在一起，进而无法使用，这种现象称为碰撞，是以太网的一个重要特征。

## 全双工通信
全双工通信又称双向同时通信，通信的双方可以同时发送和接收信息。生活中就像打电话及网络所使用的交换机。
相比于半双工模式的集线器，交换机的全双工模式可以同时发送和接收信号。使用双绞线时，发送和接收的信号线是独立的，因此在双绞线中信号不会像集线器那样发生碰撞。如果不存在碰撞，也就不需要半双工模式的碰撞处理机制。

所以人们对以太网规范进行了修订，增加了一个无论网络中有没有信号都可以发送信号的工作模式，同时规定在这一工作模式下停用碰撞检测。这种工作模式就是全双工模式。在全双工模式下，无需等待其他信号结束就可以发送信号，因此它比全双工模式速度更快。由于双方可以同时发送数据，所以可同时传输的数据量更大，性能也就更高。

参考资料：[单工通信模式、半双工通信模式和全双工通信模式区别](https://blog.csdn.net/weixin_45797022/article/details/105788440)